import{getDateKey}from"../utils/helpers.js";export function setupEventListeners(){this.elements.completeTask.addEventListener("click",()=>this.completeTask());this.elements.failTask.addEventListener("click",()=>this.logFailure());this.elements.addMicroTask.addEventListener("click",()=>this.addEmergencyTask());this.elements.prevDay.addEventListener("click",()=>this.navigateDay(-1));this.elements.nextDay.addEventListener("click",()=>this.navigateDay(1));this.elements.todayBtn.addEventListener("click",()=>this.goToToday());this.elements.focusModeBtn.addEventListener("click",()=>this.enterFocusMode());this.elements.lockdownBtn.addEventListener("click",()=>this.enterLockdownMode());this.elements.exitFocus.addEventListener("click",()=>this.exitFocusMode());this.elements.settingsBtn.addEventListener("click",()=>this.openModal("settings"));this.elements.weeklyWarRoomBtn.addEventListener("click",()=>this.openWarRoom());this.elements.exportDataBtn.addEventListener("click",()=>this.exportData());document.getElementById("log-failure").addEventListener("click",()=>this.confirmFailure());document.getElementById("add-emergency-task").addEventListener("click",()=>this.confirmEmergencyTask());document.getElementById("save-reflection").addEventListener("click",()=>this.saveWeeklyReflection());document.getElementById("export-weekly").addEventListener("click",()=>this.exportWeeklyReport());document.getElementById("punishment-threshold").addEventListener("input",(e)=>{document.getElementById("threshold-value").textContent=`${e.target.value}%`;this.state.settings.punishmentThreshold=parseInt(e.target.value);this.saveData();});document.getElementById("brutal-mode").addEventListener("change",(e)=>{this.state.settings.brutalMode=e.target.checked;this.saveData();});document.getElementById("factory-reset").addEventListener("click",()=>{if(confirm("FACTORY RESET: Delete ALL data?")){localStorage.clear();location.reload();}});document.getElementById("clear-data").addEventListener("click",()=>{if(confirm("Clear all task data (keep settings)?")){this.state.completedTasks={};this.state.failedTasks={};this.state.emergencyTasks={};this.state.scores={daily:0,weekly:0,monthly:0,total:0,streak:0,multiplier:1.0,dailyHistory:{},};this.saveData();location.reload();}});document.querySelectorAll(".modal-close").forEach((btn)=>{btn.addEventListener("click",()=>this.closeModal());});this.elements.modalOverlay.addEventListener("click",(e)=>{if(e.target===this.elements.modalOverlay){this.closeModal();}});document.addEventListener("keydown",(e)=>this.handleKeyboardShortcuts(e));setInterval(()=>this.updateTime(),60000);setInterval(()=>this.checkDailyReset(),60000);setInterval(()=>this.updateExecutionEngine(),30000);}
export function handleKeyboardShortcuts(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"){return;}
switch(e.key.toLowerCase()){case"f":e.preventDefault();if(this.state.systemMode==="normal"){this.enterFocusMode();}
break;case"l":e.preventDefault();if(this.state.systemMode==="normal"){this.enterLockdownMode();}
break;case"s":e.preventDefault();this.openModal("settings");break;case" ":e.preventDefault();if(this.state.systemMode==="focus"||this.state.systemMode==="lockdown"){this.completeTask();}
break;case"escape":if(this.state.systemMode==="focus"){this.exitFocusMode();}
break;}}
export function updateTime(){const now=new Date();this.elements.currentTime.textContent=`${now
    .getHours()
    .toString()
    .padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;const days=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY",];this.elements.currentDay.textContent=days[this.state.selectedDate.getDay()];}
export function checkDailyReset(){const now=new Date();const resetTime=this.state.settings.resetTime.split(":");const resetHour=parseInt(resetTime[0]);const resetMinute=parseInt(resetTime[1]);const resetToday=new Date();resetToday.setHours(resetHour,resetMinute,0,0);if(now>resetToday){const todayKey=getDateKey(now);if(!this.state.analytics.lastReset||this.state.analytics.lastReset!==todayKey){this.performDailyReset();}}}
export function performDailyReset(){const todayKey=getDateKey(new Date());const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);const yesterdayKey=getDateKey(yesterday);if(this.state.emergencyTasks[yesterdayKey]){delete this.state.emergencyTasks[yesterdayKey];}
this.state.analytics.lastReset=todayKey;this.saveData();this.showNotification("Daily reset complete. New day started.","success");this.updateExecutionEngine();}